<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Spack package manager for supercomputers to install software locally | GlacierZero</title><meta name=keywords content="spack,hpc,linux"><meta name=description content="I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.
Spack to the rescue!
Let&rsquo;s see an example where one wants to use tmux in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent."><meta name=author content="Plácido Fernández Declara"><link rel=canonical href=https://glacierzero.com/blog/using_spack/><link href=/assets/css/stylesheet.min.7ecdd2a0bea01220d537dc996887b7b956c0bfd8880d1b1fb4bd7d93674ee44e.css integrity="sha256-fs3SoL6gEiDVN9yZaIe3uVbAv9iIDRsftL19k2dO5E4=" rel="preload stylesheet" as=style><link rel=icon href=https://glacierzero.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://glacierzero.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://glacierzero.com/favicon-32x32.png><link rel=apple-touch-icon href=https://glacierzero.com/apple-touch-icon.png><link rel=mask-icon href=https://glacierzero.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.96.0"><meta property="og:title" content="Using Spack package manager for supercomputers to install software locally"><meta property="og:description" content="I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.
Spack to the rescue!
Let&rsquo;s see an example where one wants to use tmux in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent."><meta property="og:type" content="article"><meta property="og:url" content="https://glacierzero.com/blog/using_spack/"><meta property="og:image" content="https://glacierzero.com/blog/img/spack-logo-white.svg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-11T10:03:17+02:00"><meta property="article:modified_time" content="2022-04-11T10:03:17+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://glacierzero.com/blog/img/spack-logo-white.svg"><meta name=twitter:title content="Using Spack package manager for supercomputers to install software locally"><meta name=twitter:description content="I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.
Spack to the rescue!
Let&rsquo;s see an example where one wants to use tmux in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent."><meta name=twitter:site content="@glacierzero"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://glacierzero.com/blog/"},{"@type":"ListItem","position":3,"name":"Using Spack package manager for supercomputers to install software locally","item":"https://glacierzero.com/blog/using_spack/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Spack package manager for supercomputers to install software locally","name":"Using Spack package manager for supercomputers to install software locally","description":"I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.\nSpack to the rescue!\nLet\u0026rsquo;s see an example where one wants to use tmux in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent.","keywords":["spack","hpc","linux"],"articleBody":"I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.\nSpack to the rescue!\nLet’s see an example where one wants to use tmux in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent. Spack allows us to quickly check those dependencies:\nspack info tmux The info command will give us an overview of the recipe: a description, available versions and build and link dependencies. A recipe contains the instructions on how to build a particular package, and on installation Spack will proceed to compile the package and all its dependencies.\nWe can check the dependencies that will be built by checking the spec of the package:\nspack spec tmux This will show not only the dependency tree, but the concrete versions, compilers, architectures and variants used to get the package compiled:\nInput spec -------------------------------- tmux  Concretized -------------------------------- tmux@3.2a%gcc@8.3.0 arch=linux-centos7-haswell  ^libevent@2.1.12%gcc@8.3.0+openssl arch=linux-centos7-haswell  ^openssl@1.1.1m%gcc@8.3.0~docs certs=system arch=linux-centos7-haswell  ^perl@5.34.0%gcc@8.3.0+cpanm+shared+threads arch=linux-centos7-haswell  ^berkeley-db@18.1.40%gcc@8.3.0+cxx~docs+stl patches=b231fcc arch=linux-centos7-haswell  ^bzip2@1.0.8%gcc@8.3.0~debug~pic+shared arch=linux-centos7-haswell  ^diffutils@3.8%gcc@8.3.0 arch=linux-centos7-haswell  ^libiconv@1.16%gcc@8.3.0 libs=shared,static arch=linux-centos7-haswell  ^gdbm@1.19%gcc@8.3.0 arch=linux-centos7-haswell  ^readline@8.1%gcc@8.3.0 arch=linux-centos7-haswell  ^ncurses@6.2%gcc@8.3.0~symlinks+termlib abi=none arch=linux-centos7-haswell  ^pkgconf@1.8.0%gcc@8.3.0 arch=linux-centos7-haswell  ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch=linux-centos7-haswell Here is where Spack shines: we can configure how the package and its dependencies will be built. A package and its dependencies will be built with the included compiler (a newer compiler can be compiled if needed) and installed locally, in a user accessible directory: no need for root permissions to install the software.\nTo customize how a package will be installed we can use several specifiers: @ for versions, % for compilers, ^ for dependencies, + for variants and ~ or - to turn off variants.\nFollowing the previous example, let say one wants to install tmux but the underlying libevent to not be built with openssl. The default variant is to use openssl as seen in the spec command: ^libevent@2.1.12%gcc@8.3.0+openssl. To do se we could do the following:\nspack spec tmux ^libevent -openssl which will give us the following dependencies tree:\nInput spec -------------------------------- tmux  ^libevent~openssl  Concretized -------------------------------- tmux@3.2a%gcc@8.3.0 arch=linux-centos7-haswell  ^libevent@2.1.12%gcc@8.3.0~openssl arch=linux-centos7-haswell  ^ncurses@6.2%gcc@8.3.0~symlinks+termlib abi=none arch=linux-centos7-haswell  ^pkgconf@1.8.0%gcc@8.3.0 arch=linux-centos7-haswell Here we are saying: tell me the configuration and dependencies of installing tmux with its libevent dependency (^) but don’t use the openssl variant for libevent (using - after the ^libevent). The same could be done for any variant, compiler version, architecture and more.\nIf satisfied with the configuration we can go ahead and install the package:\nspack install tmux ^libevent -openssl spack load tmux To check where the package is located we can use the location command or load the package and the check with something like which:\n# show path where a package is installed spack location -i tmux  # load package into environment variables spack load tmux # check its location which tmux We can even go ahead and install both variants:\nspack install tmux spack install tmux ^libevent -openssl And then load to our environment variables the one to be used:\nspack load tmux ^libevent -opensll Both version will be installed in the system at the same time, and both can be used for different configurations. The same is true for all the possible configurations in case we need a package compiled by a specific compiler, or compiler version, or architecture, etc. With all packages living in the same system and loaded dynamically.\n","wordCount":"594","inLanguage":"en","datePublished":"2022-04-11T10:03:17+02:00","dateModified":"2022-04-11T10:03:17+02:00","author":{"@type":"Person","name":"Plácido Fernández Declara"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://glacierzero.com/blog/using_spack/"},"publisher":{"@type":"Organization","name":"GlacierZero","logo":{"@type":"ImageObject","url":"https://glacierzero.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://glacierzero.com accesskey=h title="GlacierZero (Alt + H)">GlacierZero</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://glacierzero.com/about/ title=About><span>About</span></a></li><li><a href=https://glacierzero.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://glacierzero.com/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://glacierzero.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://glacierzero.com>Home</a>&nbsp;»&nbsp;<a href=https://glacierzero.com/blog/>Blogs</a></div><h1 class=post-title>Using Spack package manager for supercomputers to install software locally</h1><div class=post-meta>11 April 2022&nbsp;·&nbsp;Plácido Fernández Declara</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner></div></details></div><div class=post-content><p>I often find myself building software in different machines, with different configurations, architectures and compilers. Sometimes I just need to install some package in a server with not enough permissions to do so via the regular package manager.</p><p>Spack to the rescue!</p><p>Let&rsquo;s see an example where one wants to use <a href=/blog/tmux_workflow_nov21/>tmux</a> in a machine where it is not installed, nor one has permissions to do so. Given that python is present in the system, and a compiler, one can try to compile tmux, to quickly find it will need several dependencies like libevent. Spack allows us to quickly check those dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>spack info tmux
</span></span></code></pre></div><p>The <code>info</code> command will give us an overview of the <em>recipe</em>: a description, available versions and build and link dependencies. A <em>recipe</em> contains the instructions on how to build a particular package, and on installation Spack will proceed to compile the package and all its dependencies.</p><p>We can check the dependencies that will be built by checking the <code>spec</code> of the package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>spack spec tmux
</span></span></code></pre></div><p>This will show not only the dependency tree, but the concrete versions, compilers, architectures and variants used to get the package compiled:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Input spec
</span></span><span style=display:flex><span>--------------------------------
</span></span><span style=display:flex><span>tmux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concretized
</span></span><span style=display:flex><span>--------------------------------
</span></span><span style=display:flex><span>tmux@3.2a%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>    ^libevent@2.1.12%gcc@8.3.0+openssl arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>        ^openssl@1.1.1m%gcc@8.3.0~docs certs<span style=color:#f92672>=</span>system arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>            ^perl@5.34.0%gcc@8.3.0+cpanm+shared+threads arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                ^berkeley-db@18.1.40%gcc@8.3.0+cxx~docs+stl patches<span style=color:#f92672>=</span>b231fcc arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                ^bzip2@1.0.8%gcc@8.3.0~debug~pic+shared arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                    ^diffutils@3.8%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                        ^libiconv@1.16%gcc@8.3.0 libs<span style=color:#f92672>=</span>shared,static arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                ^gdbm@1.19%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                    ^readline@8.1%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                        ^ncurses@6.2%gcc@8.3.0~symlinks+termlib abi<span style=color:#f92672>=</span>none arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                            ^pkgconf@1.8.0%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>                ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span></code></pre></div><p>Here is where Spack shines: we can configure how the package and its dependencies will be built. A package and its dependencies will be built with the included compiler (a newer compiler can be compiled if needed) and installed locally, in a user accessible directory: no need for root permissions to install the software.</p><p>To customize how a package will be installed we can use several specifiers: <code>@</code> for versions, <code>%</code> for compilers, <code>^</code> for dependencies, <code>+</code> for variants and <code>~</code> or <code>-</code> to turn off variants.</p><p>Following the previous example, let say one wants to install tmux but the underlying libevent to not be built with openssl. The default variant is to use openssl as seen in the <code>spec</code> command: <code>^libevent@2.1.12%gcc@8.3.0+openssl</code>. To do se we could do the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>spack spec tmux ^libevent -openssl
</span></span></code></pre></div><p>which will give us the following dependencies tree:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Input spec
</span></span><span style=display:flex><span>--------------------------------
</span></span><span style=display:flex><span>tmux
</span></span><span style=display:flex><span>    ^libevent~openssl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concretized
</span></span><span style=display:flex><span>--------------------------------
</span></span><span style=display:flex><span>tmux@3.2a%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>    ^libevent@2.1.12%gcc@8.3.0~openssl arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>    ^ncurses@6.2%gcc@8.3.0~symlinks+termlib abi<span style=color:#f92672>=</span>none arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span><span style=display:flex><span>        ^pkgconf@1.8.0%gcc@8.3.0 arch<span style=color:#f92672>=</span>linux-centos7-haswell
</span></span></code></pre></div><p>Here we are saying: tell me the configuration and dependencies of installing tmux with its libevent dependency (<code>^</code>) but don&rsquo;t use the openssl variant for libevent (using <code>-</code> after the <code>^libevent</code>). The same could be done for any variant, compiler version, architecture and more.</p><p>If satisfied with the configuration we can go ahead and install the package:</p><pre tabindex=0><code>spack install tmux ^libevent -openssl
spack load tmux
</code></pre><p>To check where the package is located we can use the <code>location</code> command or <code>load</code> the package and the check with something like <code>which</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># show path where a package is installed</span>
</span></span><span style=display:flex><span>spack location -i tmux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># load package into environment variables</span>
</span></span><span style=display:flex><span>spack load tmux
</span></span><span style=display:flex><span><span style=color:#75715e># check its location</span>
</span></span><span style=display:flex><span>which tmux
</span></span></code></pre></div><p>We can even go ahead and install both variants:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>spack install tmux
</span></span><span style=display:flex><span>spack install tmux ^libevent -openssl
</span></span></code></pre></div><p>And then <code>load</code> to our environment variables the one to be used:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>spack load tmux ^libevent -opensll
</span></span></code></pre></div><p>Both version will be installed in the system at the same time, and both can be used for different configurations. The same is true for all the possible configurations in case we need a package compiled by a specific compiler, or compiler version, or architecture, etc. With all packages living in the same system and loaded dynamically.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://glacierzero.com/tags/spack/>spack</a></li><li><a href=https://glacierzero.com/tags/hpc/>hpc</a></li><li><a href=https://glacierzero.com/tags/linux/>linux</a></li></ul><nav class=paginav><a class=next href=https://glacierzero.com/blog/go_maps_usage/><span class=title>Next Page »</span><br><span>Using Go Maps: pointers and value types</span></a></nav></footer><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://glacierzero.com/blog/using_spack/",this.page.identifier="https://glacierzero.com/blog/using_spack/"};(function(){var e=document,t=e.createElement("script");t.src="https://glacierzero.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2022 <a href=https://glacierzero.com>GlacierZero</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>